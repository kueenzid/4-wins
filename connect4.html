<!--https://github.zhaw.ch/kueenden/4-Gewinnt-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vier gewinnt</title>

  <style>
    div {
      box-sizing: border-box;
    }

    .board {
      width: 84vw;
      margin: auto;
      outline: 1px solid black;
   }

    .board .field {
      border: 1px solid black;
      width: 12vw;
      height: 12vw;
      float: left;
    }

    .board .field:first-child {
      float: left;
    }

    .board .field .piece {
      width: 10vw;
      height: 10vw;
      border-radius: 50%;
      margin: 1vw;
    }
    .board .field .blue {
      background-color: blue;
    }
    .board .field .red {
      background-color: red;
    }

  </style>
<script>
  let state = {
    board: [
      [ '', '', '', '', '', '', '' ],
      [ '', '', '', '', '', '', '' ],
      [ '', '', '', '', '', '', '' ],
      [ '', '', '', '', '', '', '' ],
      [ '', '', '', '', '', '', '' ],
      [ '', '', '', '', '', '', '' ]
    ],
    color: "r"
  }

  function init() {
    document.getElementById("newGame").addEventListener("click", newGame);
    displayColor()
    showBoard()
  }

  function showBoard() {
    let board = document.getElementsByClassName("board")[0]
    board.innerHTML = ""
    for(let i = 0; i < 7 * 6; i++) {
      let row = Math.floor(i / 7)
      let node = document.createElement("div")
      board.appendChild(node)
      node.classList.add("field")
      node.id = i
      let child = document.createElement("div")
      let value = state.board[Math.floor(i / 7)][i % 7]
      if(value == "r") {
        child.setAttribute("class", "red piece")
      } else if(value == "b") {
        child.setAttribute("class", "blue piece")
      }
      node.appendChild(child)
      addListeners()
    }
  }

  function addListeners() {
    let allFields = document.getElementsByClassName("field")
    for(let i = 0; i < allFields.length; i++) {
      allFields[i].addEventListener("click", clicked)
    }
  }

  function clicked() {
    let id = this.id
    let column = id % 7
    addIntoColumn(column)
    showBoard()
  }

  function addIntoColumn(column) {
    for(let i = state.board.length - 1; i >= 0; i--) {
      if(state.board[i][column] == "") {
        state.board[i][column] = state.color
        switchColor()
        break
      }
    }
  }

  function switchColor() {
    if(state.color == "r") {
      state.color = "b"
    } else {
      state.color = "r"
    }
    displayColor()
  }

  function displayColor() {
    document.getElementById("currentColor").innerHTML = state.color == "r" ? "red" : "blue"
  }

  function newGame() {
    state = {
      board: [
        [ '', '', '', '', '', '', '' ],
        [ '', '', '', '', '', '', '' ],
        [ '', '', '', '', '', '', '' ],
        [ '', '', '', '', '', '', '' ],
        [ '', '', '', '', '', '', '' ],
        [ '', '', '', '', '', '', '' ]
      ],
      color: "r"
    }
    init()
  }
</script>

</head>
<body>
  <div class="heading">
    <button id="newGame">New Game</button><br>
    <h2 style="display: inline;">Current color: </h2><h2 id="currentColor" style="display: inline;"></h2>
  </div>

  <div class="board"></div>

  <script>
    init()
  </script>

</body>
</html>
